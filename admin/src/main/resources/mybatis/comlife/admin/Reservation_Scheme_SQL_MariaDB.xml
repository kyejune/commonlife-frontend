<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ReservationScheme">
    <select id="index" parameterType="java.util.Map" resultType="reservationSchemeInfo">
        SELECT
                *
        FROM
                `RESERVATION_SCHEMES`
        WHERE
                `DEL_YN` = 'N'
                <choose>
                    <when test='ids != null'>
                        AND
                            IDX IN
                            <foreach collection="ids" item="id" index="index" separator="," open="(" close=")">
                                #{id}
                            </foreach>
                    </when>
                </choose>
                <choose>
                    <when test='groupIdx != null'>
                        AND
                            `PARENT_IDX` = #{groupIdx}
                    </when>
                </choose>
                <choose>
                    <when test='cmplxIdx != null'>
                        AND
                            `CMPLX_IDX` = #{cmplxIdx}
                    </when>
                </choose>
    </select>
    <select id="show" parameterType="java.util.Map" resultType="reservationSchemeInfo">
        <![CDATA[
            SELECT
                    *
            FROM
                    `RESERVATION_SCHEMES`
            WHERE
                    `IDX` = #{idx}
        ]]>
    </select>
    <insert id="create" parameterType="reservationSchemeInfo">
        INSERT INTO `RESERVATION_SCHEMES`
                    (`CMPLX_IDX`,
                     `PARENT_IDX`,
                     `CODE`,
                     `RESERVATION_TYPE`,
                     `IMAGES`,
                     `TITLE`,
                     `SUMMARY`,
                     `DESCRIPTION`,
                     `IS_OPEN`,
                     `START_DT`,
                    <choose>
                        <when test='startTime != null'>
                            `START_TIME`,
                        </when>
                    </choose>
                     `END_DT`,
                    <choose>
                        <when test='endTime != null'>
                            `END_TIME`,
                        </when>
                    </choose>
                    <choose>
                        <when test='openTime != null'>
                            `OPEN_TIME`,
                        </when>
                    </choose>
                    <choose>
                        <when test='closeTime != null'>
                            `CLOSE_TIME`,
                        </when>
                    </choose>
                     `AVAILABLE_IN_WEEKEND`,
                     `POINT`,
                     `AMOUNT`,
                     `IN_STOCK`,
                     `MAX_QTY`,
                     `ACTIVATE_DURATION`,
                     `MAINTENANCE_START_AT`,
                     `MAINTENANCE_END_AT`,
                     `OPTIONS`,
                     `PRECAUTIONS`,
                     `DEL_YN`,
                     `REG_DTTM`,
                     `UPD_DTTM`)
        VALUES      (#{cmplxIdx},
                     #{parentIdx},
                     #{code},
                     #{reservationType},
                     #{images},
                     #{title},
                     #{summary},
                     #{description},
                     #{isOpen},
                     #{startDt},
                    <choose>
                        <when test='startTime != null'>
                            #{startTime},
                        </when>
                    </choose>
                     #{endDt},
                    <choose>
                        <when test='endTime != null'>
                            #{endTime},
                        </when>
                    </choose>
                    <choose>
                        <when test='openTime != null'>
                            #{openTime},
                        </when>
                    </choose>
                    <choose>
                        <when test='closeTime != null'>
                            #{closeTime},
                        </when>
                    </choose>
                     #{availableInWeekend},
                     #{point},
                     #{amount},
                     #{inStock},
                     #{maxQty},
                     #{activateDuration},
                     #{maintenanceStartAt},
                     #{maintenanceEndAt},
                     #{options},
                     #{precautions},
                     #{delYn},
                     CURRENT_TIMESTAMP,
                     CURRENT_TIMESTAMP);
    </insert>

    <select id="latest" resultType="reservationSchemeInfo">
        <![CDATA[
            SELECT  *
            FROM    `RESERVATION_SCHEMES`
            WHERE   `DEL_YN` = 'N'
            AND
                    `IDX` = LAST_INSERT_ID()
        ]]>
    </select>

    <update id="update" parameterType="reservationSchemeInfo">
        UPDATE
                `RESERVATION_SCHEMES`
        SET
                `CMPLX_IDX` = #{cmplxIdx},
                `PARENT_IDX` = #{parentIdx},
                `CODE` = #{code},
                `RESERVATION_TYPE` = #{reservationType},
                `IMAGES` = #{images},
                `TITLE` = #{title},
                `SUMMARY` = #{summary},
                `DESCRIPTION` = #{description},
                `IS_OPEN` = #{isOpen},
                `START_DT` = #{startDt},
                `END_DT` = #{endDt},
                <choose>
                    <when test='startTime != null'>
                        `START_TIME` = #{startTime},
                    </when>
                </choose>
                <choose>
                    <when test='endTime != null'>
                        `END_TIME` = #{endTime},
                    </when>
                </choose>
                <choose>
                    <when test='openTime != null'>
                        `OPEN_TIME` = #{openTime},
                    </when>
                </choose>
                <choose>
                    <when test='closeTime != null'>
                        `CLOSE_TIME` = #{closeTime},
                    </when>
                </choose>
                `AVAILABLE_IN_WEEKEND` = #{availableInWeekend},
                `POINT` = #{point},
                `AMOUNT` = #{amount},
                `IN_STOCK` = #{inStock},
                `MAX_QTY` = #{maxQty},
                `ACTIVATE_DURATION` = #{activateDuration},
                `MAINTENANCE_START_AT` = #{maintenanceStartAt},
                `MAINTENANCE_END_AT` = #{maintenanceEndAt},
                `OPTIONS` = #{options},
                `PRECAUTIONS` = #{precautions},
                `DEL_YN` = #{delYn},
                `UPD_DTTM` = CURRENT_TIMESTAMP
        WHERE
                `IDX` = #{idx}
    </update>

    <update id="delete" parameterType="reservationSchemeInfo">
        <![CDATA[
            UPDATE
                    `RESERVATION_SCHEMES`
            SET
                    `DEL_YN` = 'Y'
            WHERE
                    `IDX` = #{idx}
        ]]>
    </update>
</mapper>