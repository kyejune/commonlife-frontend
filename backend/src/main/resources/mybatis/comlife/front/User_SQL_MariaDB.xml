<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="User">

    <insert id="insertUserExt" parameterType="java.util.Map">
        INSERT
        INTO    `USR_INFO_EXT`
        (
            `USR_ID`,
            `REG_DTTM`,
            `UPD_DTTM`
        )
        VALUES
        (
            #{usrId},
            CURRENT_TIMESTAMP,
            CURRENT_TIMESTAMP
        )
        ON DUPLICATE KEY
	    UPDATE
	      UPD_DTTM=CURRENT_TIMESTAMP;
    </insert>

    <select id="selectUserListForPostById" parameterType="java.util.List" resultType="postUserInfo">
        /* Post에서 이용하는 사용자 목록 조회 */
        SELECT
            USR_INFO.USR_ID,
            USER_NM,
            IFNULL(AVATAR_IMG_SRC, NULL) AS IMG_SRC,
            IFNULL(USER_ALIAS, USER_NM) AS USER_ALIAS,
            CMPLX_NM
        FROM
          USR_INFO
            LEFT JOIN
          USR_INFO_EXT
              ON USR_INFO.USR_ID = USR_INFO_EXT.USR_ID
            JOIN
          COMPLEX_M
              ON USR_INFO.CMPLX_ID = COMPLEX_M.CMPLX_ID
        WHERE
            USR_INFO.USR_ID
        IN
        <foreach collection="list" item="item" index="index" separator="," open="(" close=")">
            #{item}
        </foreach>
    </select>

    <select id="selectUserListById" parameterType="java.util.List" resultType="userInfo">
        /* ID리스트로 사용자 조회 */
        SELECT
                *
        FROM
                USR_INFO
        WHERE
                USR_ID
                IN
        <foreach collection="list" item="item" index="index" separator="," open="(" close=")">
            #{item}
        </foreach>
    </select>

    <select id="selectUsrIdByUserIdAndPw" parameterType="java.util.List" resultType="userInfo">
        /* ID/PASSWORD로 USR_ID 가져오기*/
        SELECT
          USR_ID,
          USER_ID
        FROM
          USR_INFO
        WHERE
          USER_ID=#{userId} AND USER_PW=#{userPw}
    </select>

    <select id="selectUsrIdByUserId" parameterType="java.util.List" resultType="userInfo">
        /* ID 중복 검사 확인*/
        SELECT
          USER_ID
        FROM
          USR_INFO
        WHERE
          USER_ID=#{userId}
    </select>

    <select id="selectUserRelatedInfo" parameterType="Map" resultType="Map">
      SELECT
    </select>

</mapper>