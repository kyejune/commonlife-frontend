<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="PostFile">

    <select id="selectPostFile" parameterType="java.util.Map" resultType="postFileInfo">
        SELECT  *
        FROM    `POST_FILE`
        <if test="postFileIdx != null">
        WHERE   `POST_FILE_IDX` = #{postFileIdx}
        </if>
        <if test="postIdx != null">
        WHERE   `POST_IDX` = #{postIdx}
        </if>
        <if test="postIdxs != null">
        WHERE   `POST_IDX`
                IN
                <foreach collection="postIdxs" item="item" index="index" separator="," open="(" close=")">
                    #{item}
                </foreach>
        </if>
    </select>

    <insert id="insertPostFile" parameterType="postFileInfo">
        <![CDATA[
            INSERT
            INTO    `POST_FILE`
            (
                `USR_ID`,
                `MIME_TYPE`,
                `FILE_PATH`,
                `REG_DTTM`,
                `UPD_DTTM`
            )
            VALUES
            (
                0,
                #{mimeType},
                #{filePath},
                CURRENT_TIMESTAMP,
                CURRENT_TIMESTAMP
            )
        ]]>
    </insert>

    <select id="selectLatestPostFile" resultType="postFileInfo">
        <![CDATA[
            SELECT  *
            FROM    `POST_FILE`
            WHERE   `DEL_YN` = 'N'
            AND
                    `POST_FILE_IDX` = LAST_INSERT_ID()
        ]]>
    </select>

    <update id="bindPostToPostFiles" parameterType="java.util.Map">
        UPDATE  `POST_FILE`
        SET     `POST_IDX` =  #{postIdx}
        <if test="postFileIdx != null">
            WHERE   `POST_FILE_IDX` =   #{postFileIdx}
        </if>
        <if test="postFileIdxs != null">
            WHERE   `POST_FILE_IDX`
                    IN
                    <foreach collection="postFileIdxs" item="item" index="index" separator="," open="(" close=")">
                        #{item}
                    </foreach>
        </if>
    </update>

    <delete id="deletePostFile" parameterType="java.util.Map">
        <![CDATA[
            UPDATE  `POST_FILE`
            SET     `DEL_YN` =  'Y',
                    `UPD_DTTM` =    CURRENT_TIMESTAMP
            WHERE   `POST_FILE_IDX` =   #{postFileIdx}
        ]]>
    </delete>

</mapper>