<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Post">

    <select id="countPostList" resultType="java.lang.Integer">
    <![CDATA[
        SELECT
                COUNT( * ) as COUNT
        FROM
                `POST`
    ]]>
    </select>

    <select id="selectPostList" parameterType="java.util.Map" resultType="postInfo">
    <![CDATA[
        /* 공통게시판 리스트 조회 */
        SELECT
                *,
                (
                    SELECT
                            COUNT( * )
                    FROM
                            `LIKE`
                    WHERE
                            `PARENT_IDX` = `POST_IDX`
                ) as LIKES_COUNT
        FROM
                `POST`
        WHERE
                `DEL_YN` = 'N'
        ORDER BY POST_IDX DESC -- 생성기준, 역순으로 표시
        LIMIT
                #{limit}
        OFFSET
                #{offset}

    ]]>
    </select>

    <select id="selectPost" parameterType="java.util.Map" resultType="postInfo">
    <![CDATA[
        SELECT
                *
        FROM
                `POST`
        WHERE
                `DEL_YN` = 'N'
                AND
                `POST_IDX` = #{postIdx}
    ]]>
    </select>

    <select id="selectLatestPost" resultType="postInfo">
    <![CDATA[
        SELECT
                *
        FROM
                `POST`
        WHERE
                `DEL_YN` = 'N'
                AND
                `POST_IDX` = LAST_INSERT_ID()
    ]]>
    </select>

    <insert id="insertPost" parameterType="postInfo">
    <![CDATA[
        INSERT
        INTO    `POST`
        (
            `POST_TYPE`,
            `CONTENT`,
            `USR_ID`,
            `REG_DTTM`,
            `UPD_DTTM`
        )
        VALUES
        (
            #{postType},
            #{content},
            #{usrId},
            CURRENT_TIMESTAMP,
            CURRENT_TIMESTAMP
        )
    ]]>
    </insert>

    <update id="updatePost" parameterType="postInfo">
    <![CDATA[
        UPDATE  `POST`
        SET     `POST_TYPE` =  #{postType},
                `CONTENT` =     #{content},
                `UPD_DTTM` =    CURRENT_TIMESTAMP
        WHERE   `POST_IDX` =   #{postIdx}
    ]]>
    </update>

    <update id="deletePost" parameterType="postInfo">
    <![CDATA[
        UPDATE  `POST`
        SET     `DEL_YN` =  'Y',
                `UPD_DTTM` =    CURRENT_TIMESTAMP
        WHERE   `POST_IDX` =   #{postIdx}
    ]]>
    </update>

</mapper>